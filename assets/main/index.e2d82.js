window.__require=function t(e,o,i){function n(r,s){if(!o[r]){if(!e[r]){var h=r.split("/");if(h=h[h.length-1],!e[h]){var a="function"==typeof __require&&__require;if(!s&&a)return a(h,!0);if(c)return c(h,!0);throw new Error("Cannot find module '"+r+"'")}r=h}var l=o[r]={exports:{}};e[r][0].call(l.exports,function(t){return n(e[r][1][t]||t)},l,l.exports,t,e,o,i)}return o[r].exports}for(var c="function"==typeof __require&&__require,r=0;r<i.length;r++)n(i[r]);return n}({Helloworld:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","Helloworld");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),c=this&&this.__decorate||function(t,e,o,i){var n,c=arguments.length,r=c<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(r=(c<3?n(r):c>3?n(e,o,r):n(e,o))||r);return c>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=t("./fgui/JoystickModule"),s=cc._decorator,h=s.ccclass,a=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.text="hello",e}return n(e,t),e.prototype.onLoad=function(){fgui.GRoot.create(),fgui.UIPackage.loadPackage("UI/Joystick",this.onUILoaded.bind(this));var t=cc.director.getPhysicsManager();t.enabled=!0,t.gravity=cc.v2(0,0)},e.prototype.start=function(){this.label.string=this.text,fgui.GRoot.create(),fgui.UIPackage.loadPackage("UI/Bag",this.onBagUILoaded.bind(this)),this._joystickPanel=cc.find("Canvas/UI/testNode02")},e.prototype.onUILoaded=function(){this._view=fgui.UIPackage.createObject("Joystick","Main").asCom,this._view.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height),fgui.GRoot.inst.addChild(this._view),this._text=this._view.getChild("n9").asTextField,this._text.setPosition(100,10),this._joystick=new r.default(this._view),this._joystick.on(r.default.JoystickMoving,this.onJoystickMoving,this),this._joystick.on(r.default.JoystickUp,this.onJoystickUp,this)},e.prototype.onJoystickMoving=function(t,e,o){this._text.text=" ---- "+Math.round(t)+", "+Math.round(e)+", "+Math.round(o),this.role.getComponent(cc.RigidBody).linearVelocity.x=Math.round(e),this.role.getComponent(cc.RigidBody).linearVelocity.y=Math.round(o),this.role.getComponent(cc.RigidBody).linearVelocity=new cc.Vec2(2*e,2*-o)},e.prototype.onJoystickUp=function(){this._text.text="",this.role.getComponent(cc.RigidBody).linearVelocity=new cc.Vec2(0,0)},e.prototype.onBagUILoaded=function(){var t=fgui.UIPackage.createObject("Bag","Main").asCom;t.setSize(fgui.GRoot.inst.width,fgui.GRoot.inst.height),fgui.GRoot.inst.addChild(t),fgui.UIPackage.loadPackage("UI/Joystick",this.onUILoaded.bind(this))},c([a(cc.Node)],e.prototype,"role",void 0),c([a(cc.Node)],e.prototype,"jp",void 0),c([a(cc.Label)],e.prototype,"label",void 0),c([a],e.prototype,"text",void 0),c([h],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./fgui/JoystickModule":"JoystickModule"}],JoystickModule:[function(t,e,o){"use strict";cc._RF.push(e,"80374UrcMtB37whRLxmgocM","JoystickModule");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var c=function(t){function e(e){var o=t.call(this)||this;o._button=e.getChild("joystick").asButton,o._button.changeStateOnClick=!1,o._thumb=o._button.getChild("thumb"),o._touchArea=e.getChild("joystick_touch"),o._center=e.getChild("joystick_center"),o._center.setPosition(220,0),o._InitX=o._center.x+o._center.width/2,o._InitY=o._center.y+o._center.height/2,o._touchId=-1,o.radius=100,o._curPos=new cc.Vec2,o._touchArea.on(fgui.Event.TOUCH_BEGIN,o.onTouchDown,o),o._touchArea.on(fgui.Event.TOUCH_MOVE,o.onTouchMove,o),o._touchArea.on(fgui.Event.TOUCH_END,o.onTouchEnd,o),o._touchArea.setSize(e.width,e.height),o._touchArea.setPosition(0,0);var i=cc.find("Canvas/UI/testNode02");console.log(i.x,i.y);var n=i,c=n.convertToWorldSpaceAR(cc.v2(0,0));console.log("ccNodePos",c.x,n.y);var r=cc.v2(c.x,cc.winSize.height-c.y);console.log("screenPos",r.x,r.y);var s=(new fgui.GObject).globalToLocal(r.x,r.y);console.log("fairyGuiPos",s.x,s.y),o._touchArea.setSize(i.width,i.height),o._touchArea.setPosition(0,0),o._touchArea.setPosition(r.x,r.y);var h=new fgui.GButton;return e.addChild(h),h.text="111",h.setPosition(0,0),h.titleColor=cc.Color.BLUE,o}return n(e,t),e.prototype.trigger=function(t){this.onTouchDown(t)},e.prototype.onTouchDown=function(t){if(-1==this._touchId){this._touchId=t.touchId,this._tweener&&(this._tweener.kill(),this._tweener=null),fgui.GRoot.inst.globalToLocal(t.pos.x,t.pos.y,this._curPos);var e=this._curPos.x,o=this._curPos.y;this._button.selected=!0,this._thumb.visible=!0,e<0?e=0:e>this._touchArea.width&&(e=this._touchArea.width),o>fgui.GRoot.inst.height?o=fgui.GRoot.inst.height:o<this._touchArea.y&&(o=this._touchArea.y),this._lastStageX=e,this._lastStageY=o,this._startStageX=e,this._startStageY=o,this._center.visible=!0,this._center.x=e-this._center.width/2,this._center.y=o-this._center.height/2,this._button.x=e-this._button.width/2,this._button.y=o-this._button.height/2;var i=e-this._InitX,n=o-this._InitY,c=180*Math.atan2(n,i)/Math.PI;this._thumb.rotation=c+90,t.captureTouch()}},e.prototype.onTouchMove=function(t){if(-1!=this._touchId&&t.touchId==this._touchId){var o=t.pos.x,i=t.pos.y,n=o-this._lastStageX,c=i-this._lastStageY;this._lastStageX=o,this._lastStageY=i;var r=this._button.x+n,s=this._button.y+c,h=r+this._button.width/2-this._startStageX,a=s+this._button.height/2-this._startStageY,l=Math.atan2(a,h),u=180*l/Math.PI;this._thumb.rotation=u+90;var p=this.radius*Math.cos(l),d=this.radius*Math.sin(l);Math.abs(h)>Math.abs(p)&&(h=p),Math.abs(a)>Math.abs(d)&&(a=d),(r=this._startStageX+h)<0&&(r=0),(s=this._startStageY+a)>fgui.GRoot.inst.height&&(s=fgui.GRoot.inst.height),this._button.x=r-this._button.width/2,this._button.y=s-this._button.height/2,this.emit(e.JoystickMoving,u,p,d)}},e.prototype.onTouchEnd=function(t){if(-1!=this._touchId&&t.touchId==this._touchId)return this._touchId=-1,this._thumb.visible=!1,this._center.visible=!1,void this.emit(e.JoystickUp)},e.prototype.onTweenComplete=function(){this._tweener=null,this._button.selected=!1,this._thumb.rotation=0,this._center.visible=!0,this._center.x=this._InitX-this._center.width/2,this._center.y=this._InitY-this._center.height/2,this._center.visible=!1},e.JoystickMoving="JoystickMoving",e.JoystickUp="JoystickUp",e}(cc.EventTarget);o.default=c,cc._RF.pop()},{}],camera:[function(t,e,o){"use strict";cc._RF.push(e,"d07e5cRyNhEv4fhtQ7GNeFE","camera");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),c=this&&this.__decorate||function(t,e,o,i){var n,c=arguments.length,r=c<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(r=(c<3?n(r):c>3?n(e,o,r):n(e,o))||r);return c>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,h=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.text="hello",e}return n(e,t),e.prototype.start=function(){},e.prototype.update=function(){var t=this.role.convertToWorldSpaceAR(new cc.Vec3(0,0,0)),e=this.node.parent.convertToNodeSpaceAR(t);this.node.position=e},c([h(cc.Label)],e.prototype,"label",void 0),c([h],e.prototype,"text",void 0),c([h(cc.Node)],e.prototype,"role",void 0),c([s],e)}(cc.Component);o.default=a,cc._RF.pop()},{}],test01:[function(t,e,o){"use strict";cc._RF.push(e,"b6ffcz0+yFOcIOBGfYljbd7","test01");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),c=this&&this.__decorate||function(t,e,o,i){var n,c=arguments.length,r=c<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(r=(c<3?n(r):c>3?n(e,o,r):n(e,o))||r);return c>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,h=r.property,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.text="hello",e}return n(e,t),e.prototype.convTilePosToUiPos=function(t,e){var o=this.tilemap.getTileSize(),i=this.tilemap.getMapSize().width,n=this.tilemap.getMapSize().height,c=i*o.width,r=n*o.height;console.log("mapInfo",o.width,o.width,i,n,c,r);var s=new cc.Vec2(0,0);return s.x=t-c/2,s.y=e-r/2,console.log("convRet",t,e,s.x,s.y),s},e.prototype.getMapObjById=function(t){for(var e=this.getComponent(cc.TiledObjectGroup).getObjects(),o=0;o<e.length;o++){var i=e[o];if(i.id==t)return i}return null},e.prototype.testPolygonCollider=function(){var t=this.getMapObjById("23");if(t){var e=this.convTilePosToUiPos(t.x,t.y);console.log("poly",e.x,e.y,t.x,t.y,t.width,t.height,t.points);var o=new cc.Node;o.group="wall";var i=o.addComponent(cc.PhysicsPolygonCollider);o.getComponent(cc.RigidBody).type=cc.RigidBodyType.Static,console.log("--------",i),i.points=[];for(var n=0;n<t.points.length;n++){var c=t.points[n];i.points.push(new cc.Vec2(c.x,c.y))}this.uiNode.addChild(o),o.setPosition(e.x,e.y)}else console.log("testPolygonCollider() error")},e.prototype.start=function(){this.testPolygonCollider();var t=this.getComponent(cc.TiledObjectGroup).getObjects();console.log("cs",t),console.log("p1",t[1]);var e=t[2];console.log(e.x,e.y,e.width,e.height);var o=this.tilemap.getTileSize(),i=(cc.size(o.width*this.tilemap.getTileSize().width,o.height*this.tilemap.getTileSize().height),new cc.Vec2(e.x,e.y)),n=i.x-960,c=-(1552-i.y);console.log("tileposxy",i.x,i.y,n,c);var r=e.width,s=e.height,h=new cc.Node;h.group="wall";var a=h.addComponent(cc.PhysicsBoxCollider);h.getComponent(cc.RigidBody).type=cc.RigidBodyType.Static,a.size.width=r,a.size.height=s,this.uiNode.addChild(h),h.setPosition(n+r/2,c-s/2),console.log("------",h.getContentSize(),a.size)},c([h(cc.Label)],e.prototype,"label",void 0),c([h],e.prototype,"text",void 0),c([h(cc.TiledMap)],e.prototype,"tilemap",void 0),c([h(cc.TiledLayer)],e.prototype,"topLayer",void 0),c([h(cc.Camera)],e.prototype,"cam",void 0),c([h(cc.Node)],e.prototype,"uiNode",void 0),c([s],e)}(cc.Component);o.default=a,cc._RF.pop()},{}]},{},["Helloworld","camera","JoystickModule","test01"]);